$(document).ready(function(){var b={mapDOM:document.getElementById("theMap"),mapCenter:new google.maps.LatLng("41.845","-87.669"),mapOptions:{zoom:11,mapTypeControl:true,mapTypeId:google.maps.MapTypeId.TERRAIN,streetViewControl:false,panControl:false,zoomControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.LEFT_TOP}},potholeDataURL:"http://data.cityofchicago.org/api/views/ktq5-qe3d/rows.json?jsonp=?",potholeMarkers:Array(),potholeInfo:Array(),potholeData:null,wardLayer:null,wardTableId:"3057562",wardColumn:"geometry",theAddress:false,geocoder:new google.maps.Geocoder(),addrMarker:false,addCommas:function(c){c+="";subStr=c.split(".");subStr1=subStr[0];subStr2=subStr.length>1?"."+subStr[1]:"";regx=/(\d+)(\d{3})/;while(regx.test(subStr1)){subStr1=subStr1.replace(regx,"$1,$2")}return subStr1+subStr2},displayCount:function(c){$("#numResults").fadeOut(function(){$("#numResults").html('<div class="alert"><strong>Calculating...</strong></div>')});$("#numResults").fadeIn(function(){$("#numResults").html('<div class="alert alert-info"><strong>'+b.addCommas(c)+" Open Requests</strong></div>")})},openInfoBox:function(e,c,d){return function(){d.open(e,c)}},potholeDataHandler:function(d){if(d==null){isAddrSearch=true;markerLat=b.addrMarker.getPosition().lat();markerLng=b.addrMarker.getPosition().lng()}else{isAddrSearch=false;b.potholeData=d}numRows=parseInt(b.potholeData.data.length);potholeLatLng=Array();b.potholeMarkers=Array();potholeText=Array();b.potholeInfo=Array();numShown=0;for(var c=1;c<numRows;c++){if(isAddrSearch==false||(isAddrSearch==true&&b.potholeData.data[c][13][1]!=null&&b.potholeData.data[c][13][2]!=null&&((b.potholeData.data[c][13][1]<(markerLat+0.004))&&(b.potholeData.data[c][13][1]>(markerLat-0.004))&&(b.potholeData.data[c][13][2]<(markerLng+0.005))&&(b.potholeData.data[c][13][2]>(markerLng-0.005))))){numShown++;potholeLatLng[c]=new google.maps.LatLng(b.potholeData.data[c][13][1],b.potholeData.data[c][13][2]);date=b.potholeData.data[c][8].replace("T00:00:00","");potholeText[c]='<div class="infoWindow" style="border:1px solid rgb(188,232,241); margin-top:8px; background:rgb(217,237,247); padding:5px; font-size:80%;">'+b.potholeData.data[c][12]+"<br />Ticket: "+b.potholeData.data[c][11]+"<br />Created: "+date+"<br /></div>";b.potholeMarkers[c]=new google.maps.Marker({position:potholeLatLng[c],map:a,icon:"img/r.png"});potholeInfoBoxOptions={content:potholeText[c],disableAutoPan:false,maxWidth:0,pixelOffset:new google.maps.Size(-140,0),zIndex:null,boxStyle:{background:"url('img/tipbox.gif') no-repeat",opacity:0.95,width:"160px"},closeBoxMargin:"10px 2px 2px 2px",closeBoxURL:"http://www.google.com/intl/en_us/mapfiles/close.gif",infoBoxClearance:new google.maps.Size(1,1),isHidden:false,pane:"floatPane",enableEventPropagation:false};b.potholeInfo[c]=new InfoBox(potholeInfoBoxOptions);google.maps.event.addListener(b.potholeMarkers[c],"click",b.openInfoBox(a,b.potholeMarkers[c],b.potholeInfo[c]))}}b.displayCount(numShown)},addressSearch:function(){b.theAddress=$("#address").val();if(b.theAddress!=""&&b.theAddress!=false){b.theAddress+=" Chicago IL";b.geocoder.geocode({address:b.theAddress},function(d,c){if(c==google.maps.GeocoderStatus.OK){if(b.addrMarker!=false){b.addrMarker.setMap(null)}b.clearMarkers();a.setCenter(d[0].geometry.location);a.setZoom(15);b.addrMarker=new google.maps.Marker({position:d[0].geometry.location,map:a,animation:google.maps.Animation.DROP});b.potholeDataHandler(null)}else{alert("We could not locate your address: "+c)}})}else{if(b.addrMarker!=false){b.addrMarker.setMap(null)}}},clearMarkers:function(){if(b.potholeMarkers.length>0){for(var c in b.potholeMarkers){b.potholeMarkers[c].setMap(null);b.potholeInfo[c].setMap(null)}}}};var a=new google.maps.Map(b.mapDOM,b.mapOptions);a.setCenter(b.mapCenter);$.get(b.potholeDataURL,b.potholeDataHandler,"jsonp");b.wardLayer=new google.maps.FusionTablesLayer(b.wardTableId,{query:"SELECT "+b.wardColumn+" FROM "+b.wardTableId});$("#wards").click(function(){if($("#wards").is(":checked")){b.wardLayer.setMap(a)}else{b.wardLayer.setMap(null)}});$("#map-refresh").click(b.addressSearch);$("#map-all").click(function(){if(b.addrMarker!=false){b.addrMarker.setMap(null);a.setCenter(b.mapCenter);a.setZoom(11)}b.potholeDataHandler(b.potholeData);$("#address").val("")});$("#toggle-more").click(function(c){$("#content-more").toggle("fast");$("#toggle-more").text(($("#toggle-more").text()=="Show more")?"Show less":"Show more")});$("#theForm").submit(function(){return false})});